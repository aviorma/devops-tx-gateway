apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "tx-gateway.fullname" . }}-nginx-config
  labels:
    {{- include "tx-gateway.labels" . | nindent 4 }}
data:
  default.conf: |
    server {
      listen       {{ .Values.service.targetPort }};
      listen  [::]:{{ .Values.service.targetPort }};
      server_name  localhost;

      # Default location
      location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
      }

      # Stub status endpoint for Prometheus exporter (localhost only)
      location /stub_status {
        stub_status on;
        access_log off;
        allow 127.0.0.1;
        allow ::1;
        deny all;
      }

      # Health check endpoint
      location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
      }

      error_page   500 502 503 504  /50x.html;
      location = /50x.html {
        root   /usr/share/nginx/html;
      }
    }


replicaCount: 3

image:
  repository: aviorma/tx-gateway
  tag: latest
  pullPolicy: IfNotPresent

fullnameOverride: ""
nameOverride: ""

service:
  type: ClusterIP
  port: 80
  targetPort: 8080

ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: chart-example.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 300m
    memory: 512Mi

env:
  ENVIRONMENT: default

# Prometheus metrics exporter (sidecar container)
metrics:
  enabled: true
  image:
    repository: bitnami/nginx-exporter
    tag: 1.4.2
    pullPolicy: IfNotPresent
  port: 9113
  resources:
    requests:
      cpu: 10m
      memory: 32Mi
    limits:
      cpu: 50m
      memory: 64Mi

hpa:
  enabled: true
  minReplicas: 3
  maxReplicas: 8
  targetCPUUtilizationPercentage: 70

# KEDA-based autoscaling using Prometheus metrics from tx-gateway's own /metrics endpoint
# When enabled, KEDA will create and manage its own HPA based on requests-per-second
# Metrics are exposed by nginx-prometheus-exporter sidecar (see metrics.enabled above)
keda:
  enabled: false
  minReplicas: 3
  maxReplicas: 10
  pollingInterval: 30   # seconds
  cooldownPeriod: 300   # seconds
  prometheus:
    # Address of your Prometheus server (cluster-internal)
    serverAddress: "http://prometheus-server.monitoring.svc.cluster.local"
    # Metric exposed by nginx-prometheus-exporter sidecar (nginx_http_requests_total)
    metricName: "nginx_http_requests_total"
    # Threshold for avg RPS per pod to trigger scaling
    threshold: "100"
    # PromQL query: sum of request rate across all tx-gateway pods
    query: "sum(rate(nginx_http_requests_total{job=\"tx-gateway\"}[1m]))"

pdb:
  enabled: true
  minAvailable: 2

networkPolicy:
  enabled: false

serviceMonitor:
  enabled: false
  interval: 30s
  additionalLabels: {}

podAnnotations: {}

nodeSelector: {}

tolerations: []

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - tx-gateway
          topologyKey: topology.kubernetes.io/zone
      - weight: 50
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - tx-gateway
          topologyKey: kubernetes.io/hostname
